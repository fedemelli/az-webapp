<h2>Blob Lifecycle Management</h2>
        <p><strong>Lifecycle Management</strong> permette di automatizzare il movimento dei blob tra i tier di accesso e la loro eliminazione, ottimizzando i costi di storage in base a policy temporali.</p>

        <svg viewBox="0 0 600 200" style="width:100%;max-width:600px;margin:20px auto;display:block;">
          <defs>
            <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#6366f1"/>
            </marker>
          </defs>
          <!-- Timeline -->
          <line x1="50" y1="100" x2="550" y2="100" stroke="#cbd5e1" stroke-width="3"/>
          <!-- Stages -->
          <circle cx="100" cy="100" r="30" fill="#ef4444"/>
          <text x="100" y="105" text-anchor="middle" fill="white" font-weight="bold" font-size="11">Hot</text>
          <text x="100" y="145" text-anchor="middle" fill="#64748b" font-size="10">Giorno 0</text>

          <circle cx="220" cy="100" r="30" fill="#3b82f6"/>
          <text x="220" y="105" text-anchor="middle" fill="white" font-weight="bold" font-size="11">Cool</text>
          <text x="220" y="145" text-anchor="middle" fill="#64748b" font-size="10">+30 giorni</text>

          <circle cx="340" cy="100" r="30" fill="#06b6d4"/>
          <text x="340" y="105" text-anchor="middle" fill="white" font-weight="bold" font-size="11">Cold</text>
          <text x="340" y="145" text-anchor="middle" fill="#64748b" font-size="10">+90 giorni</text>

          <circle cx="460" cy="100" r="30" fill="#8b5cf6"/>
          <text x="460" y="105" text-anchor="middle" fill="white" font-weight="bold" font-size="11">Archive</text>
          <text x="460" y="145" text-anchor="middle" fill="#64748b" font-size="10">+180 giorni</text>

          <!-- Arrows -->
          <line x1="135" y1="100" x2="185" y2="100" stroke="#6366f1" stroke-width="2" marker-end="url(#arrowhead2)"/>
          <line x1="255" y1="100" x2="305" y2="100" stroke="#6366f1" stroke-width="2" marker-end="url(#arrowhead2)"/>
          <line x1="375" y1="100" x2="425" y2="100" stroke="#6366f1" stroke-width="2" marker-end="url(#arrowhead2)"/>

          <!-- Delete option -->
          <line x1="460" y1="130" x2="460" y2="170" stroke="#ef4444" stroke-width="2" stroke-dasharray="4"/>
          <text x="460" y="185" text-anchor="middle" fill="#ef4444" font-size="10">Delete +365g</text>
        </svg>

        <h3>Come Funziona</h3>
        <p>Una <strong>Lifecycle Policy</strong> Ã¨ composta da <strong>regole</strong> che definiscono:</p>
        <ul>
          <li><strong>Filtri</strong>: quali blob sono interessati dalla regola</li>
          <li><strong>Azioni</strong>: cosa fare con i blob che corrispondono ai filtri</li>
          <li><strong>Condizioni</strong>: quando eseguire le azioni (basate su giorni)</li>
        </ul>

        <h3>Azioni Disponibili</h3>
        <table style="width:100%;border-collapse:collapse;margin:16px 0;">
          <thead>
            <tr style="background:#f1f5f9;">
              <th style="padding:12px;text-align:left;border:1px solid #e2e8f0;">Azione</th>
              <th style="padding:12px;text-align:left;border:1px solid #e2e8f0;">Descrizione</th>
              <th style="padding:12px;text-align:left;border:1px solid #e2e8f0;">Applicabile a</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:12px;border:1px solid #e2e8f0;"><code>tierToCool</code></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Sposta blob al tier Cool</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Block blob, base blob, snapshot, versioni</td>
            </tr>
            <tr style="background:#f8fafc;">
              <td style="padding:12px;border:1px solid #e2e8f0;"><code>tierToCold</code></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Sposta blob al tier Cold</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Block blob, base blob, snapshot, versioni</td>
            </tr>
            <tr>
              <td style="padding:12px;border:1px solid #e2e8f0;"><code>tierToArchive</code></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Sposta blob al tier Archive</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Block blob, base blob, snapshot, versioni</td>
            </tr>
            <tr style="background:#f8fafc;">
              <td style="padding:12px;border:1px solid #e2e8f0;"><code>delete</code></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Elimina definitivamente il blob</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Block blob, append blob, base blob, snapshot, versioni</td>
            </tr>
          </tbody>
        </table>

        <h3>Filtri Disponibili</h3>
        <ul>
          <li><strong>blobTypes</strong>: <code>blockBlob</code> o <code>appendBlob</code></li>
          <li><strong>prefixMatch</strong>: array di prefissi container/blob (es. <code>["logs/", "backup/2023"]</code>)</li>
          <li><strong>blobIndexMatch</strong>: condizioni basate su blob index tags</li>
        </ul>

        <h3>Esempio di Policy JSON</h3>
        <pre><code>{
  "rules": [
    {
      "name": "move-to-cool-after-30-days",
      "enabled": true,
      "type": "Lifecycle",
      "definition": {
        "filters": {
          "blobTypes": ["blockBlob"],
          "prefixMatch": ["logs/"]
        },
        "actions": {
          "baseBlob": {
            "tierToCool": {
              "daysAfterModificationGreaterThan": 30
            },
            "tierToArchive": {
              "daysAfterModificationGreaterThan": 180
            },
            "delete": {
              "daysAfterModificationGreaterThan": 365
            }
          }
        }
      }
    }
  ]
}</code></pre>

        <h3>Configurazione con Azure CLI</h3>
        <pre><code># Impostare una lifecycle policy da file JSON
az storage account management-policy create \\
  --account-name mystorageaccount \\
  --resource-group myResourceGroup \\
  --policy @lifecycle-policy.json

# Visualizzare la policy corrente
az storage account management-policy show \\
  --account-name mystorageaccount \\
  --resource-group myResourceGroup</code></pre>

        <h3>Condizioni Temporali</h3>
        <p>Le azioni possono essere basate su diverse condizioni temporali:</p>
        <ul>
          <li><code>daysAfterModificationGreaterThan</code>: giorni dalla <strong>ultima modifica</strong></li>
          <li><code>daysAfterCreationGreaterThan</code>: giorni dalla <strong>creazione</strong></li>
          <li><code>daysAfterLastAccessTimeGreaterThan</code>: giorni dall'<strong>ultimo accesso</strong> (richiede Last Access Time Tracking abilitato)</li>
        </ul>

        <h3>Best Practices</h3>
        <ul>
          <li>Usa <strong>prefixMatch</strong> per organizzare i blob in "cartelle" logiche</li>
          <li>Testa le policy su un container di prova prima di applicarle in produzione</li>
          <li>Considera il <strong>minimo 30 giorni in Cool</strong> e <strong>180 giorni in Archive</strong> per evitare early deletion charges</li>
          <li>Abilita <strong>Last Access Time Tracking</strong> per policy basate sull'utilizzo effettivo</li>
        </ul>

        <h3>Considerazioni per l'Esame</h3>
        <ul>
          <li>Le policy sono eseguite <strong>una volta al giorno</strong> (non in real-time)</li>
          <li>Solo <strong>block blob</strong> supporta tutti i tier; append blob non supporta tiering</li>
          <li>I blob in <strong>Archive</strong> devono essere reidratati prima di essere accessibili</li>
          <li>Le versioni e gli snapshot possono avere policy separate dal base blob</li>
        </ul>