<h2>Azure File Sync</h2>
        <p><strong>Azure File Sync</strong> permette di centralizzare le condivisioni file in Azure Files mantenendo la flessibilità, le performance e la compatibilità di un file server Windows on-premises. Trasforma Windows Server in una cache veloce della share Azure.</p>

        <svg viewBox="0 0 600 320" style="width:100%;max-width:600px;margin:20px auto;display:block;">
          <!-- Azure Cloud -->
          <rect x="200" y="10" width="200" height="130" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
          <text x="300" y="35" text-anchor="middle" font-weight="bold" fill="#1e40af" font-size="13">Azure</text>

          <!-- Storage Sync Service -->
          <rect x="220" y="50" width="160" height="35" rx="6" fill="#3b82f6"/>
          <text x="300" y="73" text-anchor="middle" fill="white" font-size="11">Storage Sync Service</text>

          <!-- Azure File Share -->
          <rect x="220" y="95" width="160" height="35" rx="6" fill="#60a5fa"/>
          <text x="300" y="118" text-anchor="middle" fill="white" font-size="11">Azure File Share</text>

          <!-- On-premises -->
          <rect x="50" y="180" width="500" height="130" rx="12" fill="#f1f5f9" stroke="#64748b" stroke-width="2"/>
          <text x="300" y="205" text-anchor="middle" font-weight="bold" fill="#334155" font-size="13">On-Premises</text>

          <!-- Server 1 -->
          <rect x="80" y="220" width="120" height="70" rx="6" fill="#22c55e"/>
          <text x="140" y="250" text-anchor="middle" fill="white" font-size="11">Windows Server</text>
          <text x="140" y="270" text-anchor="middle" fill="white" font-size="9">+ Azure File Sync Agent</text>

          <!-- Server 2 -->
          <rect x="240" y="220" width="120" height="70" rx="6" fill="#22c55e"/>
          <text x="300" y="250" text-anchor="middle" fill="white" font-size="11">Windows Server</text>
          <text x="300" y="270" text-anchor="middle" fill="white" font-size="9">Branch Office</text>

          <!-- Server 3 -->
          <rect x="400" y="220" width="120" height="70" rx="6" fill="#22c55e"/>
          <text x="460" y="250" text-anchor="middle" fill="white" font-size="11">Windows Server</text>
          <text x="460" y="270" text-anchor="middle" fill="white" font-size="9">DR Site</text>

          <!-- Sync arrows -->
          <line x1="140" y1="220" x2="280" y2="140" stroke="#3b82f6" stroke-width="2"/>
          <line x1="300" y1="220" x2="300" y2="140" stroke="#3b82f6" stroke-width="2"/>
          <line x1="460" y1="220" x2="320" y2="140" stroke="#3b82f6" stroke-width="2"/>

          <!-- Sync label -->
          <text x="300" y="165" text-anchor="middle" fill="#3b82f6" font-size="10" font-weight="bold">Sync</text>
        </svg>

        <h3>Componenti Principali</h3>
        <table style="width:100%;border-collapse:collapse;margin:16px 0;">
          <thead>
            <tr style="background:#f1f5f9;">
              <th style="padding:12px;text-align:left;border:1px solid #e2e8f0;">Componente</th>
              <th style="padding:12px;text-align:left;border:1px solid #e2e8f0;">Descrizione</th>
              <th style="padding:12px;text-align:left;border:1px solid #e2e8f0;">Dove</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:12px;border:1px solid #e2e8f0;"><strong>Storage Sync Service</strong></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Risorsa Azure che gestisce la sincronizzazione</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Azure</td>
            </tr>
            <tr style="background:#f8fafc;">
              <td style="padding:12px;border:1px solid #e2e8f0;"><strong>Sync Group</strong></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Definisce la topologia: quali endpoint sincronizzare</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Azure</td>
            </tr>
            <tr>
              <td style="padding:12px;border:1px solid #e2e8f0;"><strong>Cloud Endpoint</strong></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">La Azure File Share da sincronizzare</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Azure</td>
            </tr>
            <tr style="background:#f8fafc;">
              <td style="padding:12px;border:1px solid #e2e8f0;"><strong>Server Endpoint</strong></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Path locale su Windows Server</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">On-premises</td>
            </tr>
            <tr>
              <td style="padding:12px;border:1px solid #e2e8f0;"><strong>Azure File Sync Agent</strong></td>
              <td style="padding:12px;border:1px solid #e2e8f0;">Software installato su Windows Server</td>
              <td style="padding:12px;border:1px solid #e2e8f0;">On-premises</td>
            </tr>
          </tbody>
        </table>

        <h3>Cloud Tiering</h3>
        <p>Funzionalità opzionale che trasforma il server in una "cache intelligente":</p>
        <ul>
          <li>I file <strong>meno usati</strong> vengono sostituiti con "placeholder" (pochi KB)</li>
          <li>Il contenuto reale rimane in Azure Files</li>
          <li>Quando si accede al file, viene scaricato <strong>on-demand</strong></li>
          <li>Libera spazio disco mantenendo l'accesso trasparente ai file</li>
        </ul>

        <h4>Policy di Cloud Tiering</h4>
        <ul>
          <li><strong>Volume Free Space</strong>: mantiene X% di spazio libero sul volume</li>
          <li><strong>Date Policy</strong>: tier file non acceduti negli ultimi X giorni</li>
        </ul>

        <h3>Deployment Step-by-Step</h3>
        <ol>
          <li><strong>Crea Storage Sync Service</strong> in Azure</li>
          <li><strong>Prepara Windows Server</strong>: disabilita IE Enhanced Security, firewall</li>
          <li><strong>Installa Azure File Sync Agent</strong> sul server</li>
          <li><strong>Registra il server</strong> con Storage Sync Service</li>
          <li><strong>Crea Sync Group</strong> e aggiungi Cloud Endpoint (Azure File Share)</li>
          <li><strong>Aggiungi Server Endpoint</strong> (path locale sul server)</li>
        </ol>

        <h3>Requisiti Windows Server</h3>
        <ul>
          <li>Windows Server 2016, 2019, o 2022</li>
          <li>Volume NTFS (non supporta ReFS)</li>
          <li>PowerShell 5.1 o successivo</li>
          <li>.NET Framework 4.7.2 o successivo</li>
          <li>Porte in uscita: 443 (HTTPS)</li>
        </ul>

        <h3>Comandi PowerShell</h3>
        <pre><code># Registrare il server
Register-AzStorageSyncServer \\
  -ResourceGroupName "myResourceGroup" \\
  -StorageSyncServiceName "mySyncService"

# Creare sync group
New-AzStorageSyncGroup \\
  -ResourceGroupName "myResourceGroup" \\
  -StorageSyncServiceName "mySyncService" \\
  -Name "mySyncGroup"

# Aggiungere server endpoint
New-AzStorageSyncServerEndpoint \\
  -ResourceGroupName "myResourceGroup" \\
  -StorageSyncServiceName "mySyncService" \\
  -SyncGroupName "mySyncGroup" \\
  -ServerResourceId $registeredServer.ResourceId \\
  -ServerLocalPath "D:\\FileShare" \\
  -CloudTiering</code></pre>

        <h3>Considerazioni per l'Esame</h3>
        <ul>
          <li>Un <strong>Sync Group può avere 1 solo Cloud Endpoint</strong> (Azure File Share)</li>
          <li>Ma può avere <strong>multipli Server Endpoint</strong> (max 100 per sync group)</li>
          <li>Cloud Tiering richiede almeno <strong>50+ MB liberi</strong> sul server</li>
          <li>I file "tiered" hanno l'attributo <strong>offline</strong> in Windows</li>
          <li>Un server può essere registrato con <strong>un solo Storage Sync Service</strong></li>
        </ul>