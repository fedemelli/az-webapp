<h2>Custom Script Extension</h2>
<p>La <strong>Custom Script Extension</strong> √® uno dei metodi pi√π semplici per configurare una VM dopo il deployment.
  Scarica automaticamente gli script da Azure Storage o GitHub e li esegue.</p>

<h3>Workflow</h3>
<svg viewBox="0 0 600 180"
  style="width:100%;max-width:600px;margin:24px auto;display:block;background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:16px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);">
  <!-- Storage -->
  <rect x="50" y="60" width="100" height="60" rx="8" fill="#e0e7ff" stroke="#4f46e5" stroke-width="2" />
  <text x="100" y="95" text-anchor="middle" font-weight="bold" fill="#3730a3">Storage</text>
  <text x="100" y="110" text-anchor="middle" font-size="10" fill="#4338ca">Script.ps1</text>

  <!-- Arrow 1 -->
  <path d="M160 90 L240 90" stroke="#64748b" stroke-width="2" marker-end="url(#arrow14)" />
  <text x="200" y="80" text-anchor="middle" font-size="11" fill="#64748b">Download</text>

  <!-- VM -->
  <rect x="250" y="40" width="140" height="100" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" />
  <text x="320" y="65" text-anchor="middle" font-weight="bold" fill="#1e40af">Azure VM</text>

  <!-- Agent -->
  <rect x="270" y="80" width="100" height="40" rx="4" fill="white" stroke="#2563eb" />
  <text x="320" y="105" text-anchor="middle" font-size="11" fill="#1e40af">VM Agent</text>

  <!-- Arrow 2 -->
  <path d="M400 90 L480 90" stroke="#64748b" stroke-width="2" marker-end="url(#arrow14)" />
  <text x="440" y="80" text-anchor="middle" font-size="11" fill="#64748b">Execute</text>

  <!-- Output -->
  <rect x="490" y="60" width="80" height="60" rx="8" fill="#f0fdf4" stroke="#16a34a" stroke-width="2" />
  <text x="530" y="95" text-anchor="middle" font-weight="bold" fill="#14532d">Output</text>

  <defs>
    <marker id="arrow14" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
    </marker>
  </defs>
</svg>

<h3>Esempio CLI</h3>
<div
  style="background:linear-gradient(135deg,#1e293b,#0f172a);border-radius:12px;padding:20px;margin:20px 0;overflow-x:auto;">
  <pre
    style="margin:0;color:#e2e8f0;font-size:13px;line-height:1.6;font-family:'Consolas','Monaco',monospace;"><code><span style="color:#94a3b8;"># Eseguire uno script PowerShell su VM Windows</span>
<span style="color:#38bdf8;">az vm extension set</span> <span style="color:#a78bfa;">\\</span>
  <span style="color:#fbbf24;">--resource-group</span> MyRG <span style="color:#a78bfa;">\\</span>
  <span style="color:#fbbf24;">--vm-name</span> MyWindowsVM <span style="color:#a78bfa;">\\</span>
  <span style="color:#fbbf24;">--name</span> CustomScriptExtension <span style="color:#a78bfa;">\\</span>
  <span style="color:#fbbf24;">--publisher</span> Microsoft.Compute <span style="color:#a78bfa;">\\</span>
  <span style="color:#fbbf24;">--settings</span> '{"fileUris": ["https://mystorage.blob.core.windows.net/scripts/install.ps1"], "commandToExecute": "powershell -ExecutionPolicy Unrestricted -File install.ps1"}'</code></pre>
</div>

<!-- Callout esame -->
<div
  style="background:linear-gradient(135deg,#dbeafe,#bfdbfe);border-left:4px solid #3b82f6;border-radius:12px;padding:20px;margin-top:24px;">
  <div style="display:flex;align-items:flex-start;gap:12px;">
    <span style="font-size:24px;">üìù</span>
    <div>
      <strong style="color:#1e40af;font-size:15px;">Tips per l'Esame AZ-104</strong>
      <ul style="margin:8px 0 0 0;padding-left:20px;color:#1e3a8a;font-size:14px;">
        <li>Custom Script Extension ha un <strong>timeout di 90 minuti</strong>. Se lo script dura di pi√π, fallisce.
        </li>
        <li>Si pu√≤ eseguire <strong>una sola</strong> Custom Script Extension per VM alla volta.</li>
        <li>Usa <code>protectedSettings</code> per passare dati sensibili (come password o SAS token) in modo cifrato.
        </li>
        <li>Lo script viene eseguito con privilegi di <strong>System</strong> (Windows) o <strong>Root</strong> (Linux).
        </li>
      </ul>
    </div>
  </div>
</div>